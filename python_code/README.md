core logic, implemented in Python3
